# Cross.jl vs Kore Comprehensive Analysis - Index

**Analysis Date**: October 26, 2025  
**Analyst**: Claude Code  
**Status**: COMPLETE

---

## Overview

This directory contains a comprehensive comparison between the Cross.jl implementation and the reference Kore implementation. The analysis identifies one **critical bug** in mode selection for m=0 cases and validates that all other major components correctly implement Kore's physics.

---

## Documents

### 1. COMPARISON_SUMMARY.txt
**Quick Reference Guide** - Start here for an executive summary.

- **Length**: ~2 pages
- **Purpose**: High-level overview of findings
- **Key Sections**:
  - Critical findings (1 bug identified)
  - Correct implementations (everything else)
  - Cross-reference table
  - Recommendations
  - Testing guidelines

**Best for**: Quick understanding of what was found and what actions are needed.

---

### 2. COMPREHENSIVE_COMPARISON_REPORT.md
**Detailed Technical Analysis** - Full technical documentation.

- **Length**: ~30 pages
- **Purpose**: Detailed line-by-line comparison
- **Key Sections**:
  1. Mode Selection and Symmetry (CRITICAL ISSUE)
  2. Heating Mode Implementation
  3. Boundary Condition Implementation
  4. Matrix Construction and Assembly
  5. Numerical Parameters and Tolerances
  6. Coriolis and Velocity Coupling
  7. Symmetry Constraint Application
  8. Summary of Findings
  9. Appendix with code locations

**Best for**: Understanding implementation details, tracking down specific differences, validating fixes.

---

## Key Findings Summary

### Critical Bug Found
**Mode Selection for m=0 Cases**
- **Location**: `src/SparseOperator.jl:240-260`, function `compute_l_modes()`
- **Issue**: Includes invalid l=0 and excludes l=lmax+1 for m=0 cases
- **Impact**: Reduced spectral accuracy for axially symmetric flows
- **Severity**: CRITICAL
- **Action Required**: Fix implementation to match Kore's algorithm

**Example**:
```
For m=0, lmax=10, symm=1:
Kore (correct):    top=[2,4,6,8,10],    bot=[1,3,5,7,9,11]
Cross.jl (wrong):  top=[0,2,4,6,8,10],  bot=[1,3,5,7,9]
                    ^                          ^
                   BUG                       BUG
```

### Everything Else Is Correct
All other major components match Kore perfectly:
- ✓ Heating operators (differential/internal)
- ✓ Boundary conditions (tau method vs explicit, but same physics)
- ✓ Matrix operators (Coriolis, viscous, buoyancy, advection)
- ✓ Bidirectional velocity coupling
- ✓ Symmetry constraints

---

## Code Reference

### Cross-Reference Table

| Component | Kore Location | Cross.jl Location |
|-----------|---------------|-------------------|
| Mode Selection | `bin/utils.py:174-183` | `src/SparseOperator.jl:240-260` ⚠️ BUG |
| Heating Ops | `bin/operators.py:699-770` | `src/SparseOperator.jl:504-562` ✓ |
| Boundary Conditions | `bin/assemble.py:1188-1340` | `src/SparseOperator.jl:816-921` ✓ |
| Matrix Assembly | `bin/assemble.py:429-812` | `src/SparseOperator.jl:578-800` ✓ |
| Coriolis Coupling | `bin/operators.py:48-124` | `src/SparseOperator.jl:311-425` ✓ |

---

## How to Use These Documents

### For Quick Understanding
1. Read `COMPARISON_SUMMARY.txt` (5 minutes)
2. Focus on the "Critical Findings" section
3. Review the "Recommendations" section

### For Implementation/Bug Fix
1. Read `COMPREHENSIVE_COMPARISON_REPORT.md` Section 1
2. Review the test case table showing the bug
3. Implement the recommended fix
4. Run validation tests (see COMPARISON_SUMMARY.txt)

### For Validation/Verification
1. Read the full `COMPREHENSIVE_COMPARISON_REPORT.md`
2. Cross-check each component with provided code locations
3. Verify equivalence of different implementation approaches
4. Use as reference for future enhancements

---

## Recommendation for Bug Fix

The mode selection bug is **not optional** - it breaks all m=0 (axially symmetric) problems. 

### Simple Fix Path
Replace the current `compute_l_modes()` implementation with logic that:
1. Generates l-range using `sign(m)` like Kore does
2. Extends to l=lmax+1 for m=0 cases
3. Applies symmetry-based parity selection

See "Recommended Fix" section in COMPREHENSIVE_COMPARISON_REPORT.md Section 1 for pseudocode.

---

## Testing Checklist

After implementing the fix:
- [ ] Verify m=0, lmax=10, symm=±1 modes match Kore
- [ ] Compare m=0 convection Rayleigh numbers with Kore
- [ ] Test higher lmax values (20, 30)
- [ ] Run full regression test suite

---

## Questions or Further Analysis?

For detailed explanations, refer to the specific section in `COMPREHENSIVE_COMPARISON_REPORT.md`:
- **Heating**: Section 2
- **Boundary Conditions**: Section 3
- **Matrix Construction**: Section 4
- **Numerical Issues**: Section 5
- **Coupling**: Sections 6-7

---

**Generated by**: Claude Code at Anthropic  
**Analysis Tools**: Grep, Glob, Read, Bash  
**Methodology**: Line-by-line code comparison with test case validation
